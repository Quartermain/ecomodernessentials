{%unless collectionIds%} 
  {% assign collectionIds = '' %}
  {% if collection %}
    {% capture collectionIds %}{{ collection.id }}{% endcapture %}  	
  {% elsif product %}
    {% capture collectionIds %}{{ product.collections | map: 'id' | join: "," }}{% endcapture %}
  {% endif%}  
{% endunless %}
<div class="visely-widget-container container page-width">
  <h3 class="visely-recommendations-title" data-visely-widget-title-element="MOST_POPULAR_PER_COLLECTION">Most Popular per Collection:</h3>
  <div class="most-popular-per-collection visely-widget-wrapper" data-visely-recommendation-type="MOST_POPULAR_PER_COLLECTION" data-visely-most-popular-collection="{{collectionIds}}">
    {% include 'visely-recommendation-item-template' %}
    <div class="visely-pagination" data-visely-pagination></div>
  </div>
</div>
<script>document.dispatchEvent( new CustomEvent('viselyWidgetInit', {detail: { widgetType: 'MOST_POPULAR_PER_COLLECTION' }}));</script>